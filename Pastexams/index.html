<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>IFé¡Œåº«</title>
    <style>
        :root{--ink:#1A202C;--smoke:#718096;--ice:#EDF2F7;--brand:#3182CE;--ok:#48BB78;--ng:#F56565}*{-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0;padding:0}body{font-family:"Segoe UI","PingFang TC",sans-serif;background:#F8FAFC;color:var(--ink);padding:10px;display:flex;flex-direction:column;align-items:center;min-height:100vh}#login-screen{position:fixed;inset:0;background:#FFF;display:flex;align-items:center;justify-content:center;z-index:9999}.login-box{width:85%;max-width:320px;text-align:center}.login-box h2{font-size:1.5rem;margin-bottom:25px;font-weight:800}.login-box input{width:100%;padding:16px;border-radius:12px;border:2px solid var(--ice);font-size:1.2rem;text-align:center;margin-bottom:15px;outline:0}.login-box button{width:100%;padding:16px;border-radius:12px;border:none;background:var(--brand);color:#fff;font-size:1.1rem;font-weight:700;cursor:pointer}.container{width:100%;max-width:480px;display:none}.top-nav{display:flex;align-items:center;gap:8px;margin-bottom:12px}.menu-bar{display:flex;background:var(--ice);padding:4px;border-radius:12px;flex:1;height:48px}.menu-item{flex:1;border:none;background:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:15px;color:var(--smoke)}.menu-item.active{background:#FFF;color:var(--brand);box-shadow:0 2px 6px rgba(0,0,0,.08)}.icon-btn{background:#FFF;border:1px solid var(--ice);width:42px;height:42px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px}.filter-panel{background:#FFF;padding:12px;border-radius:16px;margin-bottom:12px;border:1px solid var(--ice)}.filter-group{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px}.tag-btn{padding:6px 14px;border:none;background:var(--ice);border-radius:8px;font-size:13px;font-weight:700;color:var(--smoke);white-space:nowrap}.tag-btn.active{background:var(--brand);color:#FFF}.control-row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;padding-top:10px;border-top:1px solid var(--ice)}.status-info{text-align:center;flex:1}#progress{font-size:13px;font-weight:900;color:var(--brand);display:block}#qTag{font-size:11px;color:var(--smoke);font-weight:600}.toggle-box{display:flex;flex-direction:column;align-items:center;gap:4px;font-size:11px;font-weight:800;color:var(--smoke)}.toggle{position:relative;width:36px;height:20px}.toggle input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;inset:0;background:#CBD5E0;border-radius:20px;transition:.2s}.slider:before{position:absolute;content:"";height:16px;width:16px;left:2px;bottom:2px;background:#FFF;border-radius:50%;transition:.2s}input:checked+.slider{background:var(--ok)}input:checked+.slider:before{transform:translateX(16px)}.quiz-card{background:#FFF;border-radius:20px;padding:25px 20px;border:1px solid var(--ice);margin-bottom:12px;min-height:140px;display:flex;flex-direction:column;justify-content:center}.q-text{font-size:1.3rem;font-weight:800;line-height:1.5;text-align:center;color:var(--ink)}.ans-area{margin-top:15px;padding:12px;border-radius:12px;background:#F0FFF4;display:none;border-left:4px solid var(--ok)}.options-list{display:flex;flex-direction:column;gap:10px;width:100%}.option{background:#FFF;border:2px solid var(--ice);border-radius:14px;padding:14px;display:flex;align-items:center;cursor:pointer;font-size:16px;font-weight:600}.opt-no{width:26px;height:26px;background:var(--ice);border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:12px;font-size:12px;font-weight:900;color:var(--smoke);flex-shrink:0}.option.correct{background:#F0FFF4!important;border-color:var(--ok)!important;color:var(--ok)!important}.option.wrong{background:#FFF5F5!important;border-color:var(--ng)!important;color:var(--ng)!important}.option.selected{border-color:var(--brand);background:#EBF8FF}.next-btn{width:100%;padding:18px;border-radius:16px;border:none;background:var(--brand);color:#FFF;font-size:1.15rem;font-weight:800;margin-top:15px;cursor:pointer}
    </style>
</head>
<body>
<div id="login-screen"><div class="login-box"><h2>å±•æ¾èƒ½æ‹‰å¹¾ä¸‹å–®æ§“ï¼Ÿ</h2><input type="password" id="pw-input" placeholder="è«‹è¼¸å…¥æ¬¡æ•¸" inputmode="numeric"><button id="login-btn" onclick="_v()">é–‹å§‹æ»¿ç™¾ä¹‹æ—…</button><div style="margin-top:20px;font-size:10px;color:#A0AEC0">2026/2/27 02:55 V6.2 Optimized</div></div></div>
<div class="container" id="main-ui">
    <div class="top-nav"><div id="sheetMenu" class="menu-bar"></div><button class="icon-btn" onclick="location.reload()">ğŸ”„</button><button class="icon-btn" onclick="_lo()">ğŸšª</button></div>
    <div class="filter-panel">
        <div class="filter-group" id="type-filters"><button class="tag-btn active" onclick="_ft('å…¨éƒ¨',this)">å…¨éƒ¨</button><button class="tag-btn" onclick="_ft('æ˜¯é',this)">æ˜¯é</button><button class="tag-btn" onclick="_ft('å–®é¸',this)">å–®é¸</button><button class="tag-btn" onclick="_ft('å¤šé¸',this)">å¤šé¸</button></div>
        <div id="subject-filters" class="filter-group"></div>
        <div class="control-row">
            <div class="toggle-box"><span>é¡Œç›®éš¨æ©Ÿ</span><label class="toggle"><input type="checkbox" id="randQ" checked onchange="_i()"><span class="slider"></span></label></div>
            <div class="status-info"><span id="progress"></span><span id="qTag"></span></div>
            <div class="toggle-box"><span>é¸é …éš¨æ©Ÿ</span><label class="toggle"><input type="checkbox" id="randO" checked onchange="_d()"><span class="slider"></span></label></div>
        </div>
    </div>
    <div class="quiz-card"><div id="qText" class="q-text">è®€å–ä¸­...</div><div id="ansBox" class="ans-area"><b id="ansLabel" style="font-size:11px;color:var(--ok);display:block;margin-bottom:4px">ğŸ’¡ æ­£ç¢ºè§£ç­”</b><div id="ansVal" style="font-size:14px;font-weight:600"></div></div></div>
    <div id="options" class="options-list"></div><button id="mainBtn" class="next-btn" disabled>ä¸‹ä¸€é¡Œ</button>
</div>
<script>
    const _A="https://script.google.com/macros/s/AKfycbwRLbo2UAXBLJJXuYCG2tooN0nxX87R0SfzcANeNgwIqkoq6fQTrFZ5rqrj9KwnJEQl/exec";
    let _r=[],_q=[],_x=0,_t='å…¨éƒ¨',_s='å…¨éƒ¨',_sh=new URLSearchParams(window.location.search).get('sheet');
    window.onload=()=>{sessionStorage.getItem("auth")==="true"&&_st()};
    async function _v(){const p=document.getElementById('pw-input').value,b=document.getElementById('login-btn');if(!p)return;b.disabled=!0;b.innerText="é©—è­‰ä¸­...";let i="Unknown";try{const r=await fetch('https://api.ipify.org?format=json'),d=await r.json();i=d.ip}catch(e){}try{const r=await fetch(`${_A}?type=checkAuth&pw=${encodeURIComponent(p)}&ip=${i}&device=Mobile&ua=${encodeURIComponent(navigator.userAgent)}`),j=await r.json();if(j.auth){sessionStorage.setItem("auth","true");_st()}else{alert('è¼¸å…¥æ¬¡æ•¸ä¸å°å–”ï¼');b.disabled=!1;b.innerText="é–‹å§‹ç·´ç¿’"}}catch(e){alert('é€£ç·šå¤±æ•—');b.disabled=!1}}
    async function _st(){document.getElementById('login-screen').style.display='none';document.getElementById('main-ui').style.display='block';const r=await fetch(`${_A}?type=listSheets`),n=await r.json();if(!_sh)_sh=n[0];document.getElementById('sheetMenu').innerHTML=n.slice(0,2).map(x=>`<button class="menu-item ${x===_sh?'active':''}" onclick="_cs('${x}')">${x}</button>`).join('');_ld()}
    function _cs(n){window.location.href=`?sheet=${encodeURIComponent(n)}`}
    async function _ld(){const r=await fetch(`${_A}?sheet=${encodeURIComponent(_sh)}`),d=await r.json();_r=d.map(q=>{let a=q.ans.toString().toUpperCase().replace(/,/g,"").trim(),o=q.opts.filter(x=>x),t="å–®é¸";if(a==="O"||a==="X"||a==="1"||a==="2"){t="æ˜¯é";if(a==="1")a="O";if(a==="2")a="X"}else if(a.length>1&&/^\d+$/.test(a)){t="å¤šé¸"}return{q:q.q,a:a,o:o,sub:q.subject||"ä¸€èˆ¬",type:t}});const s=['å…¨éƒ¨',...new Set(_r.map(q=>q.sub))];document.getElementById('subject-filters').innerHTML=s.map(x=>`<button class="tag-btn ${_s===x?'active':''}" onclick="_fs('${x}',this)">${x}</button>`).join('');_i()}
    function _ft(t,b){_t=t;document.querySelectorAll('#type-filters .tag-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');_i()}
    function _fs(s,b){_s=s;document.querySelectorAll('#subject-filters .tag-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');_i()}
    function _i(){_q=_r.filter(q=>((_t==='å…¨éƒ¨'||q.type===_t)&&(_s==='å…¨éƒ¨'||q.sub===_s)));if(document.getElementById('randQ').checked)_q.sort(()=>Math.random()-.5);_x=0;_d()}
    function _d(){const ob=document.getElementById('options'),mb=document.getElementById('mainBtn');document.getElementById('ansBox').style.display="none";if(_x>=_q.length){document.getElementById('qText').innerText="ç·´ç¿’çµæŸï¼âœ¨";ob.innerHTML="";mb.innerText="é‡æ–°é–‹å§‹";mb.disabled=!1;mb.onclick=()=>_i();return}const q=_q[_x];document.getElementById('progress').innerText=`${_x+1} / ${_q.length}`;document.getElementById('qTag').innerText=`${q.sub} | ${q.type}`;document.getElementById('qText').innerText=q.q;ob.innerHTML="";let o=[];if(q.type==="æ˜¯é"){o=[{id:"O",t:"O"},{id:"X",t:"X"}]}else{o=q.o.map((t,i)=>({id:(i+1).toString(),t:t}));if(document.getElementById('randO').checked)o.sort(()=>Math.random()-.5)}o.forEach((x,i)=>{const b=document.createElement('div');b.className='option';b.innerHTML=`<span class="opt-no">${i+1}</span><span>${x.t}</span>`;b.onclick=()=>{if(q.type==="å¤šé¸"){b.classList.toggle('selected');mb.disabled=!1;mb.innerText="ç¢ºèªç­”æ¡ˆ";mb.onclick=()=>_jm(q,o)}else _jg(x.id,q,o,b)};b.dataset.id=x.id;ob.appendChild(b)});mb.innerText=q.type==="å¤šé¸"?"è«‹é¸æ“‡":"ä¸‹ä¸€é¡Œ";mb.disabled=!0}
    function _jg(u,q,o,b){document.querySelectorAll('.option').forEach(x=>x.onclick=null);b.classList.add(u===q.a?'correct':'wrong');_rv(q,o)}
    function _jm(q,o){document.querySelectorAll('.option').forEach(x=>x.onclick=null);const a=q.a.split("");document.querySelectorAll('.option').forEach(b=>{const i=b.dataset.id,s=b.classList.contains('selected'),c=a.includes(i);if(c)b.classList.add('correct');if(s&&!c)b.classList.add('wrong')});_rv(q,o)}
    function _rv(q,o){const a=q.a.split(""),cl=[];document.querySelectorAll('.option').forEach((el,i)=>{if(a.includes(el.dataset.id))cl.push(i+1)});document.getElementById('ansLabel').innerText=`ğŸ’¡ æ­£ç¢ºè§£ç­” ${cl.join(', ')}`;const cp=[];a.forEach(id=>{const f=o.find(x=>x.id===id);if(f){const cur=Array.from(document.querySelectorAll('.option')).findIndex(el=>el.dataset.id===id)+1;cp.push(`${cur}ã€${f.t}`)}});document.getElementById('ansVal').innerText=cp.join('ã€');document.getElementById('ansBox').style.display="block";const mb=document.getElementById('mainBtn');mb.disabled=!1;mb.innerText="ä¸‹ä¸€é¡Œ";mb.onclick=()=>{_x++;_d()}}
    function _lo(){sessionStorage.clear();location.reload()}
</script>
</body>
</html>
